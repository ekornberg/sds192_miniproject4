---
title: "sds192_miniproject4"
output: html_document
---

```{r message = FALSE, echo = FALSE, warning = FALSE}
library(tidyverse)
library(RMySQL)

db <- dbConnect(MySQL(), 
                host = "scidb.smith.edu", 
                user = "mth292", 
                password = "RememberPi", 
                dbname = "imdb")

knitr::opts_chunk$set(connection = db, max.print = 20)
```

our first effort
```{sql connection=db}
SELECT *
FROM role_type;

SELECT *
FROM movie_info;


SELECT t.title, t.production_year, mi2.info, mii.info AS votes
FROM title t
JOIN movie_info_idx mii ON mii.movie_id = t.id 
JOIN movie_info mi2 ON mi2.movie_id = t.id
WHERE kind_id = 1
AND production_year = 2018
AND mi2.info = 'English'
AND mii.info_type_id = 100
ORDER BY mi2.info desc
LIMIT 0, 100;



SELECT t.id, t.title, t.production_year, mii.info AS votes, mii2.info AS rating
FROM title t
JOIN movie_info_idx mii ON mii.movie_id = t.id
JOIN movie_info_idx mii2 ON mii2.movie_id = t.id
WHERE t.kind_id = 1
  AND t.production_year = 2019
  AND mii.info_type_id = 100
  AND mii2.info_type_id = 101
  AND mii.info > 100000
ORDER BY mii2.info desc
LIMIT 0, 100;


SELECT * FROM name WHERE name LIKE '%Downey Jr., Robert%';


SELECT t.title, t.production_year
FROM cast_info ci
JOIN title t ON ci.movie_id = t.id
JOIN char_name cn ON cn.id = ci.person_role_id
WHERE ci.person_id = 636699
AND t.kind_id = 1
AND ci.role_id = 1
ORDER BY production_year;


SELECT *
FROM company_name;
```



join name w/ top twenty thing, see how many leads in top movies in a year are women (role id 1)

```{sql connection=db}
SELECT t.id, t.title, t.production_year, mii.info AS votes, mii2.info AS rating, n.name, n.gender
FROM title t
JOIN name n ON t.id = n.id
JOIN movie_info_idx mii ON mii.movie_id = t.id
JOIN movie_info_idx mii2 ON mii2.movie_id = t.id
WHERE t.kind_id = 1
  AND mii.info_type_id = 100
  AND mii2.info_type_id = 101
  AND mii.info > 100000
ORDER BY mii2.info desc
LIMIT 0, 100;
```


